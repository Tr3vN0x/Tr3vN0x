<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tr3vN0x - Red & Black Video Site</title>
<style>
/* --- BASE & UTILITY --- */
body { font-family: Arial, sans-serif; margin:0; background:#000; color:#fff; }
.container { max-width:1200px; margin:20px auto; padding:0 20px; }
h1,h2 { color:#e53935; border-bottom:2px solid #444; padding-bottom:5px; margin-top:30px; }
header { display:flex; justify-content:space-between; align-items:center; padding:10px 20px; background:#111; box-shadow:0 2px 4px rgba(0,0,0,0.5); position:sticky; top:0; z-index:100; }
.search-container input { width:100%; padding:8px; border:1px solid #444; border-radius:4px; background:#222; color:#fff; }
.floating-auth { padding:8px 15px; background:#e53935; color:white; border-radius:4px; cursor:pointer; white-space: nowrap; }
.floating-auth.logged-out { background: #e53935; } 
.floating-auth.logged-in { background: #3954e5; } /* Changed color for logged-in user */

/* --- FEATURED PLAYER --- */
#featured { background:#1c1c1c; border-radius:8px; padding:20px; margin-top:20px; box-shadow:0 4px 8px rgba(255,0,0,0.1); }
#featured h2 { margin-top:0; border-bottom:none; font-size:1.5em; }
.featured-player { position:relative; padding-bottom:56.25%; height:0; overflow:hidden; margin-bottom:15px; }
.featured-player iframe { position:absolute; top:0; left:0; width:100%; height:100%; border:none; }

/* --- NETFLIX-STYLE VIDEO CAROUSEL (NEW/IMPROVED) --- */
.video-row { margin-bottom: 40px; }
.video-grid {
    display: flex; /* Change to flex for horizontal scrolling */
    gap: 15px;
    overflow-x: scroll; /* Enable horizontal scrolling */
    padding-bottom: 10px; /* Space for the scrollbar */
    -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
    scrollbar-width: none; /* Hide scrollbar for Firefox */
}
/* Hide scrollbar for Chrome/Safari/Opera */
.video-grid::-webkit-scrollbar {
    display: none;
}
.video-card {
    background:#1c1c1c; 
    border-radius:8px; 
    overflow:hidden; 
    cursor:pointer; 
    transition: transform 0.2s, box-shadow 0.2s;
    min-width: 280px; /* Fixed width for card */
    max-width: 280px; 
    flex-shrink: 0; /* Important: Prevents cards from shrinking */
    box-shadow:0 4px 8px rgba(0,0,0,0.3); 
}
.video-card:hover { 
    transform:scale(1.05); /* Zoom effect */
    z-index: 5;
    box-shadow:0 4px 20px rgba(255,0,0,0.6); 
}
.thumbnail-placeholder { position:relative; padding-bottom:56.25%; height:0; background:#222; }
.thumbnail-placeholder img { position:absolute; top:0; left:0; width:100%; height:100%; object-fit:cover; }
.video-info { padding:10px; }
.video-info h3 { margin:0 0 5px 0; line-height:1.4; color:#fff; font-size:1em; }
.video-info p { margin:0; font-size:0.85em; color:#bbb; }

/* --- AUTH MODAL (UNCHANGED) --- */
#auth-overlay { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); display:flex; justify-content:center; align-items:center; z-index:1000; display:none; }
.auth-modal { background:#111; border-radius:8px; width:90%; max-width:400px; box-shadow:0 5px 15px rgba(255,0,0,0.5); padding:20px; color:#fff; }
.modal-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; }
.modal-header h3 { margin:0; }
.tabs { display:flex; border-bottom:1px solid #444; margin-bottom:15px; }
.tab { flex-grow:1; text-align:center; padding:10px 15px; cursor:pointer; font-weight:bold; color:#bbb; }
.tab.active { border-bottom:2px solid #e53935; color:#e53935; }
.form-group { margin-bottom:15px; }
.form-group label { display:block; margin-bottom:5px; font-weight:600; font-size:0.9em; color:#fff; }
.form-group input { width:100%; padding:10px; border:1px solid #444; border-radius:4px; background:#222; color:#fff; box-sizing:border-box; }
.password-container { display:flex; }
.password-container input { flex-grow:1; border-right:none; border-radius:4px 0 0 4px; }
.password-container button { background:#333; border:1px solid #444; color:#fff; border-left:none; padding:10px; cursor:pointer; border-radius:0 4px 4px 0; }
button[type="submit"] { width:100%; padding:10px; background:#e53935; color:#fff; border:none; border-radius:4px; cursor:pointer; font-size:1em; margin-top:10px; }

/* --- CHAT STYLES (NEW) --- */
#chat-container {
    background: #111;
    border-radius: 8px;
    padding: 15px;
    margin-top: 40px;
    box-shadow: 0 4px 8px rgba(255,0,0,0.1);
}
#chat-messages {
    height: 300px;
    overflow-y: auto;
    border: 1px solid #333;
    padding: 10px;
    margin-bottom: 10px;
    background: #0a0a0a;
    border-radius: 4px;
    display: flex;
    flex-direction: column-reverse; /* Display new messages at the bottom */
}
.chat-message {
    margin-bottom: 8px;
    line-height: 1.4;
    font-size: 0.9em;
}
.chat-username {
    font-weight: bold;
    color: #e53935;
    margin-right: 5px;
}
#chat-input-container {
    display: flex;
    gap: 10px;
}
#chat-input {
    flex-grow: 1;
    padding: 10px;
    border: 1px solid #444;
    border-radius: 4px;
    background: #222;
    color: #fff;
}
#send-button {
    padding: 10px 15px;
    background: #e53935;
    color: #fff;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-weight: bold;
}
</style>
</head>
<body>

<header>
Â  Â  <h1>Tr3vN0x</h1>
Â  Â  <div class="search-container"><input type="text" id="searchInput" placeholder="Search videos..."></div>
Â  Â  <div class="auth-controls"><div class="floating-auth logged-out" id="floating-auth"><span id="floating-auth-text">Login</span></div></div>
</header>

<div class="container">
Â  Â  <section id="featured">
Â  Â  Â  Â  <h2>Featured: I PLAYED ROBLOX DEAD BY DAYLIGHT (IT WAS SCARY!)</h2>
Â  Â  Â  Â  <div class="featured-player"><iframe src="https://www.youtube.com/embed/92y9uaQMIa8" allowfullscreen></iframe></div>
Â  Â  </section>
    
    <div class="video-row">
        <h2>ğŸ”¥ Trending</h2>
        <div class="video-grid" id="trending-grid">
            </div>
    </div>

    <div class="video-row">
        <h2>ğŸ® Gaming Highlights</h2>
        <div class="video-grid" id="gaming-grid">
            </div>
    </div>
    
    <div class="video-row">
        <h2>âœ¨ Fan Favorites</h2>
        <div class="video-grid" id="favorites-grid">
            </div>
    </div>

    <section id="chat-container">
        <h2>ğŸ’¬ Global Chat</h2>
        <div id="chat-messages">
            </div>
        <div id="chat-input-container">
            <input type="text" id="chat-input" placeholder="Type your message..." disabled>
            <button id="send-button" disabled>Send</button>
        </div>
    </section>

Â  Â  <section id="auth-overlay">
Â  Â  Â  Â  <div class="auth-modal">
Â  Â  Â  Â  Â  Â  <div class="modal-header">
Â  Â  Â  Â  Â  Â  Â  Â  <h3>Authentication</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <span id="close-auth">&times;</span>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="tabs">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="tab active" id="login-tab">Log In</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="tab" id="signup-tab">Sign Up</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <form id="login-form">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group"><label>Email</label><input type="email" id="login-email" required></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group"><label>Password</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="password-container"><input type="password" id="login-password" required><button type="button" class="toggle-pass" data-target="login-password">ğŸ‘ï¸</button></div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit">Log In</button>
Â  Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â  Â  Â  <form id="signup-form" style="display:none;">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group"><label>Username</label><input type="text" id="signup-username" required></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group"><label>Email</label><input type="email" id="signup-email" required></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group"><label>Password</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="password-container"><input type="password" id="signup-password" required><button type="button" class="toggle-pass" data-target="signup-password">ğŸ‘ï¸</button></div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit">Sign Up</button>
Â  Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â  </div>
Â  Â  </section>
</div>

<script>
// --- GLOBAL DATA & ELEMENTS ---
const overlay = document.getElementById('auth-overlay');
const loginForm = document.getElementById('login-form');
const signupForm = document.getElementById('signup-form');
const loginTab = document.getElementById('login-tab');
const signupTab = document.getElementById('signup-tab');
const floatingAuth = document.getElementById('floating-auth');
const closeAuth = document.getElementById('close-auth');

const chatInput = document.getElementById('chat-input');
const sendButton = document.getElementById('send-button');
const chatMessagesContainer = document.getElementById('chat-messages');

let videoData = [
    { title: "I PLAYED ROBLOX DEAD BY DAYLIGHT", id: "92y9uaQMIa8", views: 0, category: 'trending' },
    { title: "Who Is TR3VN0X?", id: "ZiEd3RoiKtk", views: 0, category: 'trending' },
    { title: "Why Is Flee the Facility THIS Stressful?!", id: "Uwwga_CiFqc", views: 0, category: 'trending' },
    { title: "NEW Bloxburg House Build!", id: "rSg0kP8yYmE", views: 0, category: 'gaming' },
    { title: "Roblox Tycoon Challenge", id: "l-S3sH9fR7A", views: 0, category: 'gaming' },
    { title: "The FUNNIEST Roblox Moments", id: "P2x7l2fT0sE", views: 0, category: 'favorites' },
    { title: "Crazy Fan Mail Opening", id: "A1cT2yH4pZ5", views: 0, category: 'favorites' },
    { title: "My Favorite Game of All Time", id: "Q0w9rE8iU7y", views: 0, category: 'gaming' },
    { title: "Epic Fails Compilation", id: "M5nB6vC4xZ1", views: 0, category: 'trending' }
];

// --- AUTH UTILITY FUNCTIONS ---

function getUsers(){ 
    // FIXED: Ensure localStorage access is safe
    return JSON.parse(localStorage.getItem('tr3vn0x_users')||'[]'); 
}

function getCurrentUser() {
    return JSON.parse(localStorage.getItem('tr3vn0x_current'));
}

function updateAuthUI(user) {
    // Clear previous listeners to prevent duplicates
    floatingAuth.removeEventListener('click', showAuthModal);
    floatingAuth.removeEventListener('click', handleLogout); 

    if (user) {
        // Logged In State: Button shows username and acts as a one-click Logout button
        floatingAuth.innerText = 'Signed in as ' + user.username + ' (Log Out)';
        floatingAuth.classList.remove('logged-out');
        floatingAuth.classList.add('logged-in');
        floatingAuth.addEventListener('click', handleLogout); 
        // Enable Chat features
        chatInput.disabled = false;
        sendButton.disabled = false;
        chatInput.placeholder = "Type your message...";
    } else {
        // Logged Out State: Button shows Login and opens the modal
        floatingAuth.innerText = 'Login';
        floatingAuth.classList.remove('logged-in');
        floatingAuth.classList.add('logged-out');
        floatingAuth.addEventListener('click', showAuthModal); 
        // Disable Chat features
        chatInput.disabled = true;
        sendButton.disabled = true;
        chatInput.placeholder = "Login to chat...";
    }
}

function showAuthModal() {
    overlay.style.display='flex';
}

function handleLogout() {
    if(confirm("Are you sure you want to log out?")) {
        localStorage.removeItem('tr3vn0x_current');
        updateAuthUI(null);
        alert('You have been logged out.');
    }
}

// --- INITIAL SETUP AND EVENT LISTENERS (Authentication) ---

// Check current user on load (FIXED: ensures user stays logged in after refresh)
updateAuthUI(getCurrentUser());

// Handle modal close
closeAuth.addEventListener('click', ()=>{ overlay.style.display='none'; });

// Toggle tabs
loginTab.addEventListener('click', ()=>{
Â  Â  loginForm.style.display='block'; signupForm.style.display='none';
Â  Â  loginTab.classList.add('active'); signupTab.classList.remove('active');
});
signupTab.addEventListener('click', ()=>{
Â  Â  signupForm.style.display='block'; loginForm.style.display='none';
Â  Â  signupTab.classList.add('active'); loginTab.classList.remove('active');
});

// Password toggle
document.querySelectorAll('.toggle-pass').forEach(btn=>{
Â  Â  btn.addEventListener('click', ()=>{
Â  Â  Â  Â  const input = document.getElementById(btn.dataset.target);
Â  Â  Â  Â  input.type = input.type==='password'?'text':'password';
Â  Â  });
});

// Signup logic
signupForm.addEventListener('submit', e=>{
Â  Â  e.preventDefault();
Â  Â  const username = document.getElementById('signup-username').value.trim();
Â  Â  const email = document.getElementById('signup-email').value.trim();
Â  Â  const password = document.getElementById('signup-password').value;
Â  Â  if(!username||!email||!password){ alert('All fields required.'); return; }
Â  Â  let users = getUsers();
Â  Â  if(users.some(u=>u.username.toLowerCase()===username.toLowerCase())){ alert('Username already taken.'); return; }
Â  Â  if(users.some(u=>u.email.toLowerCase()===email.toLowerCase())){ alert('Email already registered.'); return; }
Â  Â  users.push({username,email,password});
Â  Â  localStorage.setItem('tr3vn0x_users', JSON.stringify(users));
Â  Â  alert('Signup successful! You can now log in.');
Â  Â  signupForm.reset(); loginTab.click();
});

// Login logic
loginForm.addEventListener('submit', e=>{
Â  Â  e.preventDefault();
Â  Â  const email = document.getElementById('login-email').value.trim();
Â  Â  const password = document.getElementById('login-password').value;
Â  Â  const users = getUsers();
Â  Â  // FIXED: This line finds the user
Â  Â  const user = users.find(u=>u.email.toLowerCase()===email.toLowerCase() && u.password===password);
Â  Â  if(user){
Â  Â  Â  Â  // FIXED: Save the *full* user object to localStorage for session tracking
Â  Â  Â  Â  localStorage.setItem('tr3vn0x_current', JSON.stringify(user));
        updateAuthUI(user); 
Â  Â  Â  Â  overlay.style.display='none';
Â  Â  Â  Â  loginForm.reset();
Â  Â  } else alert('Invalid email or password.');
});


// --- VIDEO RENDERING & PLAYBACK ---

// Function to generate the HTML for a single video card
function createVideoCard(video) {
    const card = document.createElement('div');
    card.classList.add('video-card');
    card.dataset.video = video.id;
    card.innerHTML = `
        <div class="thumbnail-placeholder">
            <img src="https://img.youtube.com/vi/${video.id}/hqdefault.jpg" alt="${video.title} thumbnail">
        </div>
        <div class="video-info">
            <h3>${video.title}</h3>
            <p>Views: ${video.views}</p>
        </div>
    `;
    return card;
}

// Function to render all videos into their respective rows/grids
function renderVideoRows() {
    const trendingGrid = document.getElementById('trending-grid');
    const gamingGrid = document.getElementById('gaming-grid');
    const favoritesGrid = document.getElementById('favorites-grid');

    trendingGrid.innerHTML = '';
    gamingGrid.innerHTML = '';
    favoritesGrid.innerHTML = '';

    videoData.forEach(video => {
        const card = createVideoCard(video);
        if (video.category === 'trending') trendingGrid.appendChild(card);
        else if (video.category === 'gaming') gamingGrid.appendChild(card);
        else if (video.category === 'favorites') favoritesGrid.appendChild(card);
    });
    
    // Reattach event listeners after rendering new cards (FIXED)
    document.querySelectorAll('.video-card').forEach(card => {
        card.addEventListener('click', handleVideoPlayback);
    });
}

// Function to handle video playback when a card is clicked (FIXED to allow full video replacement)
function handleVideoPlayback() {
    const videoId = this.dataset.video;
    // Create a player element
    const player = document.createElement('div');
    player.classList.add('featured-player');
    player.innerHTML = `<iframe src="https://www.youtube.com/embed/${videoId}?autoplay=1" allowfullscreen></iframe>`;
    
    // Clear the card content and insert the player
    this.innerHTML = '';
    this.appendChild(player);

    // After starting playback, prevent further clicks on the same card (optional, but prevents bugs)
    this.removeEventListener('click', handleVideoPlayback);
}

// Initial render of video rows
renderVideoRows();

// --- CHAT FUNCTIONALITY (NEW) ---

function getChatHistory() {
    // Get chat history or return empty array if none exists
    return JSON.parse(localStorage.getItem('tr3vn0x_chat') || '[]');
}

function saveChatHistory(history) {
    localStorage.setItem('tr3vn0x_chat', JSON.stringify(history));
}

function renderChatHistory() {
    const history = getChatHistory();
    // Clear current messages
    chatMessagesContainer.innerHTML = '';
    
    // Loop through history and create HTML elements
    // We use history.slice().reverse() to display newest messages at the bottom
    // since CSS flex-direction: column-reverse is used.
    history.forEach(msg => {
        const msgElement = document.createElement('div');
        msgElement.classList.add('chat-message');
        msgElement.innerHTML = `<span class="chat-username">${msg.username}:</span> ${msg.message}`;
        // Prepend (add to top) because the flexbox CSS reverses the order
        chatMessagesContainer.prepend(msgElement);
    });
}

function handleSendMessage() {
    const user = getCurrentUser();
    const message = chatInput.value.trim();

    if (!user) {
        alert("You must be logged in to chat.");
        return;
    }
    
    if (message === "") {
        return;
    }

    const history = getChatHistory();
    const newMessage = {
        username: user.username,
        message: message,
        timestamp: new Date().toISOString()
    };

    history.push(newMessage);
    saveChatHistory(history);

    // Clear input and re-render/update chat
    chatInput.value = '';
    renderChatHistory();
}

// Event listeners for chat
sendButton.addEventListener('click', handleSendMessage);
chatInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
        handleSendMessage();
    }
});

// Initial render of chat history
renderChatHistory();
</script>

</body>
</html>
